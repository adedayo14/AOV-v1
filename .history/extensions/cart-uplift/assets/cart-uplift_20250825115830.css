/* Cart Uplift – FULL DROP-IN CSS (keeps your original selectors)
   - Works with your current markup
   - Also includes .cu-* styles used by the rewritten JS (pill steppers, recs)
   - Fixes backdrop layering + blur leakage across themes
*/

/* ========================================
   Container and Backdrop
   ======================================== */
#cartuplift-app-container {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 2147483647;
  display: none;
  pointer-events: none;
}

#cartuplift-app-container.cartuplift-active {
  display: block !important;
  pointer-events: auto !important;
}

#cartuplift-app-container.cartuplift-active #cartuplift-cart-popup {
  visibility: visible; opacity: 1;
}

#cartuplift-app-container.cartuplift-active .cartuplift-cart,
#cartuplift-app-container.cartuplift-active .upcart-cart {
  will-change: transform;
}

/* ========================================
   Theme Blur Neutralizer
   ======================================== */
html.cartuplift-drawer-open body > *:not(#cartuplift-app-container),
html.cartuplift-drawer-open #MainContent,
html.cartuplift-drawer-open main,
html.cartuplift-drawer-open .shopify-section,
html.cartuplift-drawer-open .content,
html.cartuplift-drawer-open .page-width,
html.cartuplift-drawer-open .site-content,
html.cartuplift-drawer-open .page-content {
  -webkit-filter: none !important;
  filter: none !important;
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  opacity: 1 !important;
}

body:not(.cartuplift-drawer-open) *:not(#cartuplift-app-container):not(#cartuplift-app-container *) {
  -webkit-filter: none !important;
  filter: none !important;
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  pointer-events: auto !important;
  -webkit-user-select: auto !important;
  user-select: auto !important;
  touch-action: auto !important;
  opacity: 1 !important;
}

body:not(.cartuplift-drawer-open) main,
body:not(.cartuplift-drawer-open) #MainContent,
body:not(.cartuplift-drawer-open) .shopify-section,
body:not(.cartuplift-drawer-open) .page-content,
body:not(.cartuplift-drawer-open) .site-content {
  pointer-events: auto !important;
  -webkit-user-select: auto !important;
  user-select: auto !important;
  touch-action: auto !important;
}

html.cartuplift-drawer-open *:not(#cartuplift-app-container):not(#cartuplift-app-container *) {
  -webkit-filter: none !important;
  filter: none !important;
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  opacity: 1 !important;
}

html.cartuplift-drawer-open .blur,
html.cartuplift-drawer-open .blurred,
html.cartuplift-drawer-open .dimmed,
html.cartuplift-drawer-open .overlay-on,
html.cartuplift-drawer-open [style*="filter"],
html.cartuplift-drawer-open [style*="backdrop-filter"] {
  -webkit-filter: none !important;
  filter: none !important;
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  opacity: 1 !important;
}

/* Backdrop */
#cartuplift-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 2147483646;
  animation: upcartFadeIn 0.25s ease-out;
}
#cartuplift-backdrop.is-closing { animation: upcartFadeOut 0.2s ease-in forwards; }

/* Drawer anchor */
#cartuplift-cart-popup {
  position: fixed;
  top: 0; right: 0; bottom: 0;
  width: 420px; max-width: 92vw;
  z-index: 2147483647;
}

/* ========================================
   Main Cart Drawer
   ======================================== */
.upcart-cart {
  width: 100%;
  height: 100vh;
  background: #ffffff;
  box-shadow: -4px 0 20px rgba(0,0,0,.15);
  display: flex; flex-direction: column;
  overflow: hidden;
  transform: translateX(100%);
}
.upcart-cart.is-open    { animation: upcartSlideIn  .25s ease-out forwards; }
.upcart-cart.is-closing { animation: upcartSlideOut .20s ease-in  forwards; }

/* ========================================
   Header Section
   ======================================== */
.upcart-header {
  padding: 16px 20px;
  border-bottom: 1px solid #e5e5e5;
  display: flex; align-items: center; justify-content: space-between;
  background: #fff; flex-shrink: 0;
}
.upcart-header h3 { margin: 0; font-size: 18px; font-weight: 800; color: #111; letter-spacing:.02em; }
.upcart-close {
  background: none; border: none; font-size: 24px; line-height: 1;
  cursor: pointer; padding: 4px; color: #666; transition: color .15s ease;
  width: 32px; height: 32px; display: grid; place-items: center;
}
.upcart-close:hover { color: #000; }

/* ========================================
   Free Shipping Progress Section
   ======================================== */
.upcart-progress-section { display: block !important; padding: 12px 20px !important; background: #F1FAF3 !important; border-bottom: 1px solid #E6E6E6 !important; flex-shrink: 0; }
.upcart-free-shipping-bar { display: block !important; }
.upcart-free-shipping-text { font-size: 14px !important; font-weight: 800 !important; color: #0A5 !important; text-align: left !important; margin-bottom: 8px !important; display: block !important; }
.upcart-progress-bar { width: 100% !important; height: 8px !important; background: #E8F5EC !important; border-radius: 999px !important; overflow: hidden !important; display: block !important; margin-bottom: 2px !important; }
.upcart-progress-fill { height: 100% !important; background: #22c55e !important; border-radius: 999px !important; transition: width .3s ease !important; min-width: 0 !important; display: block !important; }
.upcart-progress-remaining { font-size: 12px !important; color: #47685a !important; text-align: left !important; display: block !important; }

/* ========================================
   Cart Items Section
   ======================================== */
.upcart-items { flex: 1; overflow-y: auto; padding: 0; background: #fff; }
.upcart-items-list { padding: 0; }
.upcart-empty { padding: 40px 20px; text-align: center; color: #666; }
.upcart-empty h4 { font-size: 16px; margin-bottom: 10px; color: #333; }
.upcart-empty p { font-size: 14px; color: #666; margin: 0; }

/* Items */
.upcart-item {
  display: grid;
  grid-template-columns: 80px 1fr auto 24px;
  gap: 12px; align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid #f0f0f0; background: #fff;
}
.upcart-item:last-child { border-bottom: none; }

.upcart-item-image { width: 80px; height: 80px; border-radius: 10px; overflow: hidden; background: #f5f5f5; }
.upcart-item-image img { width: 100%; height: 100%; object-fit: cover; display:block; }

.upcart-item-details { min-width: 0; display:flex; flex-direction: column; gap: 4px; }
.upcart-item-title { font-size: 14px; font-weight: 800; color: #111; text-decoration: none; line-height: 1.3; display:block; }
.upcart-item-title:hover { text-decoration: underline; color:#000; }
.upcart-item-variant { font-size: 12px; color: #6b7280; }
.upcart-item-price { font-size: 14px; font-weight: 800; color: #111; }

.upcart-item-quantity { margin-top: 6px; display: inline-flex; align-items: center; gap: 8px; }
.upcart-quantity-input {
  width: 54px; padding: 4px 8px;
  border: 1px solid #ddd; border-radius: 999px;
  text-align: center; font-size: 14px; -moz-appearance: textfield;
}
.upcart-quantity-input::-webkit-outer-spin-button,
.upcart-quantity-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

.upcart-remove-btn {
  background: none; border: none; color: #999; font-size: 12px;
  cursor: pointer; padding: 4px; text-decoration: underline; transition: color .2s;
}
.upcart-remove-btn:hover { color: #e74c3c; }

.upcart-item.loading { opacity: .6; pointer-events: none; }

/* === New: stepper pill styles used by rewritten JS (cu-*) === */
.cu-qtywrap {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 4px 8px; border: 1px solid #ddd; border-radius: 999px;
}
.cu-step {
  width: 28px; height: 28px; border-radius: 50%;
  border: none; background: #fff; cursor: pointer; font-size: 18px; line-height: 1;
}
.cu-qty {
  width: 34px; border: none; background: transparent; text-align: center; font-size: 14px;
}
.cu-qty:focus { outline: none; }

/* Remove button used by rewritten JS */
.cu-remove { border: none; background: transparent; cursor: pointer; font-size: 20px; color:#666; }
.cu-remove:hover { color:#000; }

/* ========================================
   Recommended (simple cards, used by rewritten JS)
   ======================================== */
.cu-recos { padding: 12px 16px; background: #F3F2EF; }
.cu-recos-head { display:flex; align-items:center; justify-content:space-between; margin: 0 4px 8px; }
.cu-recos-head span { font-size: 12px; font-weight: 800; letter-spacing:.06em; color:#222; }
.cu-recos-toggle { border:none; background:transparent; cursor:pointer; font-size:18px; transform: rotate(0deg); transition: transform .2s; }
.cu-recos-toggle[aria-expanded="false"] { transform: rotate(-90deg); }
.cu-recos-list { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.cu-reco { background:#fff; border-radius: 12px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,.05); }
.cu-reco-img { width: 100%; aspect-ratio: 1 / 1; object-fit: cover; border-radius: 10px; }
.cu-reco-title { margin-top: 8px; font-size: 14px; font-weight: 700; color:#111; }
.cu-reco-row { margin-top: 6px; display:flex; align-items:center; justify-content: space-between; }
.cu-reco-price { font-weight: 800; }
.cu-reco-add { border: 1px solid #111; background:#fff; color:#111; font-weight: 800; padding: 6px 10px; border-radius: 999px; cursor: pointer; }
.cu-reco-add:disabled { opacity:.5; cursor:not-allowed; }

/* ========================================
   Footer Section
   ======================================== */
.upcart-footer { padding: 16px 20px; background: #fff; border-top: 1px solid #e5e5e5; flex-shrink: 0; }

/* Discount */
.upcart-discount-section { margin-bottom: 16px; }
.upcart-discount-input-wrapper { display:flex; gap:8px; }
.upcart-discount-input { flex:1; padding:10px 12px; border:1px solid #d4d4d4; border-radius: 8px; font-size:14px; transition: border-color .15s ease; }
.upcart-discount-input:focus { outline:none; border-color:#333; }
.upcart-discount-apply { padding:10px 16px; background:#333; color:#fff; border:none; border-radius: 8px; font-size:14px; font-weight:700; cursor:pointer; }
.upcart-discount-apply:hover { background:#000; }
.upcart-discount-message { margin-top:8px; font-size:13px; padding:6px 0; }
.upcart-discount-message.error { color:#dc2626; }
.upcart-discount-message.success { color:#16a34a; }
.upcart-discount-message.loading { color:#6b7280; }

/* Notes */
.upcart-notes-section { margin-bottom: 16px; }
.upcart-notes-label { display:block; margin-bottom:6px; font-size:14px; font-weight:700; color:#333; }
.upcart-notes-textarea { width:100%; padding:10px 12px; border:1px solid #d4d4d4; border-radius: 8px; font-size:14px; resize: vertical; min-height: 60px; transition: border-color .15s ease; }
.upcart-notes-textarea:focus { outline:none; border-color:#333; }
.upcart-notes-textarea::placeholder { color:#9ca3af; }

/* Subtotal + buttons */
.upcart-subtotal { display:flex; justify-content: space-between; align-items:center; margin-bottom: 12px; font-size:16px; font-weight:800; color:#111; }
.upcart-subtotal-price { font-size:16px; font-weight:800; color:#111; }
.upcart-actions { display:flex; flex-direction: column; gap: 10px; }

.upcart-checkout {
  width:100%; padding:14px 18px; background:#111; color:#fff;
  border:none; border-radius: 10px; font-size:15px; font-weight:900; letter-spacing:.02em; cursor:pointer;
}
.upcart-checkout:hover { background:#000; }

.upcart-view-cart {
  width:100%; padding:14px 18px; background:transparent; color:#333;
  border:1px solid #ddd; border-radius: 10px; font-size:14px; font-weight:700; text-align:center; cursor:pointer;
}
.upcart-view-cart:hover { background:#f5f5f5; border-color:#999; }

/* Accelerated wallets (used by rewritten JS) */
.cu-accelerated { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
.cu-wallet { padding: 12px 10px; border: none; border-radius: 12px; font-weight: 900; cursor: pointer; }
.cu-wallet--paypal { background: #FFCC00; }
.cu-wallet--shop { background: #6C3AF2; color:#fff; }
.cu-wallet--shop span { background:#fff; color:#6C3AF2; padding: 2px 6px; margin-left:2px; border-radius: 6px; }

/* Optional “add note” pill (used by rewritten JS) */
.cu-note-toggle { margin-top:12px; width:100%; text-align:center; background:#EFEDE8; border:none; border-radius:10px; padding:10px; cursor:pointer; font-weight:700; }
.cu-note-area { margin-top:10px; }

/* ========================================
   Sticky Cart Button
   ======================================== */
#upcart-sticky { position: fixed; z-index: 2147483600; transition: transform .2s ease, box-shadow .2s ease; }
#upcart-sticky.bottom-right { bottom: 20px; right: 20px; }
#upcart-sticky.bottom-left  { bottom: 20px; left: 20px; }
#upcart-sticky.middle-right { top: 50%; right: 20px; transform: translateY(-50%); }
#upcart-sticky.middle-left  { top: 50%; left: 20px; transform: translateY(-50%); }

.upcart-trigger {
  display:flex; align-items:center; gap:8px;
  padding:12px 18px; background:#111; color:#fff; border:none; border-radius: 999px; cursor:pointer;
  box-shadow: 0 6px 16px rgba(0,0,0,.2); font-size:14px; font-weight:700;
}
.upcart-trigger:hover { transform: scale(1.05); box-shadow: 0 8px 20px rgba(0,0,0,.25); }
.upcart-trigger svg { width: 20px; height: 20px; fill: currentColor; }
.upcart-count { background:#ff4444; color:#fff; border-radius:10px; padding:2px 6px; font-size:12px; font-weight:800; min-width:20px; text-align:center; }
.upcart-total { font-weight: 800; }

/* ========================================
   Top Free Shipping Bar
   ======================================== */
.upcart-shipping-bar {
  position: fixed; top: 0; left: 0; right: 0;
  background: #f8f8f8; padding: 12px 20px; box-shadow: 0 2px 4px rgba(0,0,0,.1);
  z-index: 2147482000; animation: upcartSlideDown .3s ease;
}
.upcart-shipping-content { max-width: 1200px; margin: 0 auto; text-align: center; }
.upcart-shipping-content p { margin: 0 0 8px; font-size: 14px; font-weight: 500; color:#333; }
.upcart-shipping-progress { width: 100%; max-width: 300px; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; margin: 0 auto; }
.upcart-shipping-progress-bar { height: 100%; background: #4CAF50; transition: width .3s ease; border-radius: 4px; }
.upcart-shipping-success { background: #4CAF50; color: #fff; padding: 8px; border-radius: 4px; }
.upcart-shipping-success p { color:#fff; margin:0; }

/* ========================================
   Hide Theme Cart Drawers
   ======================================== */
[data-upcart-hidden="true"],
#CartDrawer:not(#upcart-cart-popup),
.cart-drawer:not(.upcart-cart),
.drawer--cart:not(.upcart-cart) {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* ========================================
   Animations
   ======================================== */
@keyframes upcartSlideIn  { from { transform: translateX(100%);} to { transform: translateX(0);} }
@keyframes upcartSlideOut { from { transform: translateX(0);}     to { transform: translateX(100%);} }
@keyframes upcartFadeIn   { from { opacity: 0;} to { opacity: 1;} }
@keyframes upcartFadeOut  { from { opacity: 1;} to { opacity: 0;} }
@keyframes upcartSlideDown{ from { transform: translateY(-100%);} to { transform: translateY(0);} }

/* ========================================
   Body States
   ======================================== */
body.upcart-drawer-open { overflow: hidden; }

/* ========================================
   Responsive Design
   ======================================== */
@media (max-width: 768px) {
  #cartuplift-cart-popup { width: 100%; max-width: 100vw; }
  .upcart-cart { width: 100%; }
  .upcart-header, .upcart-progress-section, .upcart-footer { padding-left: 16px; padding-right: 16px; }
  .upcart-item { grid-template-columns: 72px 1fr auto 24px; padding: 12px 16px; }
  .upcart-item-image { width: 72px; height: 72px; }
  #upcart-sticky.bottom-right, #upcart-sticky.bottom-left { bottom: 70px; }
  .upcart-trigger { padding: 10px 16px; }
}

/* ========================================
   Utility Classes
   ======================================== */
.upcart-hidden { display: none !important; }
.upcart-visible { display: block !important; }

/* ========================================
   Dark Mode Support (Optional)
   ======================================== */
@media (prefers-color-scheme: dark) {
  .upcart-cart { background: #1a1a1a; color: #fff; }
  .upcart-header, .upcart-footer { background:#1a1a1a; border-color:#333; }
  .upcart-header h3, .upcart-item-title, .upcart-item-price, .upcart-subtotal { color:#fff; }
  .upcart-close, .upcart-item-variant, .upcart-progress-remaining { color:#aaa; }
  .upcart-close:hover { color:#fff; }
  .upcart-item { border-color:#333; }
  .upcart-progress-section { background:#222 !important; border-color:#333 !important; }
  .upcart-free-shipping-text { color:#fff !important; }
  .upcart-quantity-input { background:#1a1a1a; border-color:#333; color:#fff; }
  .upcart-view-cart { background:transparent; color:#fff; border-color:#333; }
  .upcart-view-cart:hover { background:#333; border-color:#555; }
}

/* ========================================
   Print Styles
   ======================================== */
@media print {
  #upcart-app-container, #upcart-sticky, .upcart-shipping-bar { display: none !important; }
}
